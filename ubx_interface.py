from enum import Enum

SYNC1 = 0xB5  # int(181)
SYNC2 = 0x62  # int(98)

CLASS = {
    "NAV": 0x01,
    "RXM": 0x02,
    "INF": 0x04,
    "ACK": 0x05,
    "CFG": 0x06,
    "UPD": 0x09,
    "MON": 0x0A,
    "AID": 0x0B,
    "TIM": 0x0D,
    "USR": 0x40,
}

CLIDPAIR = {
    # ACK
    "ACK-ACK": (0x05, 0x01),
    "ACK-NACK": (0x05, 0x00),
    # AID: not reviewed
    "AID-ALM": (0x0B, 0x30),
    "AID-DATA": (0x0B, 0x10),
    "AID-EPH": (0x0B, 0x31),
    "AID-HUI": (0x0B, 0x02),
    "AID-INI": (0x0B, 0x01),
    "AID-REQ": (0x0B, 0x00),
    # CFG
    "CFG-ANT": (0x06, 0x13),
    "CFG-CFG": (0x06, 0x09),
    "CFG-DAT": (0x06, 0x06),
    "CFG-DGNSS": (0x06, 0x70),
    "CFG-GEOFENCE": (0x06, 0x69),
    "CFG-GNSS": (0x06, 0x3E),
    "CFG-INF": (0x06, 0x02),
    "CFG-ITFM": (0x06, 0x39),
    "CFG-LOGFILTER": (0x06, 0x47),
    "CFG-MSG": (0x06, 0x01),
    "CFG-NAV5": (0x06, 0x24),
    "CFG-NAVX5": (0x06, 0x23),
    "CFG-NMEA": (0x06, 0x17),
    "CFG-ODO": (0x06, 0x1E),
    "CFG-PRT": (0x06, 0x00),
    "CFG-PWR": (0x06, 0x57),
    "CFG-RATE": (0x06, 0x08),
    "CFG-RINV": (0x06, 0x34),
    "CFG-RST": (0x06, 0x04),
    "CFG-SBAS": (0x06, 0x16),
    "CFG-TMODE3": (0x06, 0x71),
    "CFG-TP5": (0x06, 0x31),
    "CFG-USB": (0x06, 0x1B),
    "CFG-VALDEL": (0x06, 0x8C),
    "CFG-VALGET": (0x06, 0x8B),
    "CFG-VALSET": (0x06, 0x8A),
    # CFG: not reviewed
    "CFG-TMODE": (0x06, 0x1D),
    "CFG-TP": (0x06, 0x07),
    "CFG-EKF": (0x06, 0x12),
    "CFG-FXN": (0x06, 0x0E),
    "CFG-LIC": (0x06, 0x80),
    "CFG-NAV2": (0x06, 0x1A),
    "CFG-RXM": (0x06, 0x11),
    "CFG-TM": (0x06, 0x10),
    "CFG-TM2": (0x06, 0x19),
    # INF: not reviewed
    "INF-DEBUG": (0x04, 0x04),
    "INF-ERROR": (0x04, 0x00),
    "INF-NOTICE": (0x04, 0x02),
    "INF-TEST": (0x04, 0x03),
    "INF-USER": (0x04, 0x07),
    "INF-WARNING": (0x04, 0x01),
    # MON
    "MON-COMMS": (0x0A, 0x36),
    "MON-GNSS": (0x0A, 0x28),
    "MON-HW": (0x0A, 0x09),
    "MON-HW2": (0x0A, 0x0B),
    "MON-HW3": (0x0A, 0x37),
    "MON-IO": (0x0A, 0x02),
    "MON-MSGPP": (0x0A, 0x06),
    "MON-PATCH": (0x0A, 0x27),
    "MON-RF": (0x0A, 0x38),
    "MON-RXBUF": (0x0A, 0x07),
    "MON-RXR": (0x0A, 0x21),
    "MON-SPAN": (0x0A, 0x31),
    "MON-SYS": (0x0A, 0x39),
    "MON-TXBUF": (0x0A, 0x08),
    "MON-VER": (0x0A, 0x04),
    # MON: not reviewed
    "MON-EXCEPT": (0x0A, 0x05),
    "MON-IPC": (0x0A, 0x03),
    "MON-SCHD": (0x0A, 0x01),
    "MON-USB": (0x0A, 0x0A),
    # NAV
    "NAV-CLOCK": (0x01, 0x22),
    "NAV-COV": (0x01, 0x36),
    "NAV-DOP": (0x01, 0x04),
    "NAV-EOE": (0x01, 0x61),
    "NAV-GEOFENCE": (0x01, 0x39),
    "NAV-HPPOSECEF": (0x01, 0x13),
    "NAV-HPPOSLLH": (0x01, 0x14),
    "NAV-ODO": (0x01, 0x09),
    "NAV-ORB": (0x01, 0x34),
    "NAV-PL": (0x01, 0x62),
    "NAV-POSECEF": (0x01, 0x01),
    "NAV-POSLLH": (0x01, 0x02),
    "NAV-PVT": (0x01, 0x07),
    "NAV-RELPOSNED": (0x01, 0x3C),
    "NAV-RESETODO": (0x01, 0x10),
    "NAV-SAT": (0x01, 0x35),
    "NAV-SBAS": (0x01, 0x32),
    "NAV-SIG": (0x01, 0x43),
    "NAV-SLAS": (0x01, 0x42),
    "NAV-STATUS": (0x01, 0x03),
    "NAV-SVIN": (0x01, 0x3B),
    "NAV-TIMEBDS": (0x01, 0x24),
    "NAV-TIMEGAL": (0x01, 0x25),
    "NAV-TIMEGLO": (0x01, 0x23),
    "NAV-TIMEGPS": (0x01, 0x20),
    "NAV-TIMELS": (0x01, 0x26),
    "NAV-TIMEQZSS": (0x01, 0x27),
    "NAV-TIMEUTC": (0x01, 0x21),
    "NAV-VELECEF": (0x01, 0x11),
    "NAV-VELNED": (0x01, 0x12),
    # NAV: not reviewed
    "NAV-DGPS": (0x01, 0x31),
    "NAV-EKFSTATUS": (0x01, 0x40),
    "NAV-POSUTM": (0x01, 0x08),
    "NAV-SOL": (0x01, 0x06),
    "NAV-SVINFO": (0x01, 0x30),
    # NAV2
    "NAV2-CLOCK": (0x29, 0x22),
    "NAV2-COV": (0x29, 0x36),
    "NAV2-DOP": (0x29, 0x04),
    "NAV2-EOE": (0x29, 0x61),
    "NAV2-ODO": (0x29, 0x09),
    "NAV2-POSECEF": (0x29, 0x01),
    "NAV2-POSLLH": (0x29, 0x02),
    "NAV2-PVT": (0x29, 0x07),
    "NAV2-SAT": (0x29, 0x35),
    "NAV2-SBAS": (0x29, 0x32),
    "NAV2-SIG": (0x29, 0x43),
    "NAV2-SLAS": (0x29, 0x42),
    "NAV2-STATUS": (0x29, 0x03),
    "NAV2-SVIN": (0x29, 0x3B),
    "NAV2-TIMEBDS": (0x29, 0x24),
    "NAV2-TIMEGAL": (0x29, 0x25),
    "NAV2-TIMEGLO": (0x29, 0x23),
    "NAV2-TIMEGPS": (0x29, 0x20),
    "NAV2-TIMELS": (0x29, 0x26),
    "NAV2-TIMEQZSS": (0x29, 0x27),
    "NAV2-TIMEUTC": (0x29, 0x21),
    "NAV2-VELECEF": (0x29, 0x11),
    "NAV2-VELNED": (0x29, 0x12),
    # RX2M
    "RXM-COR": (0x02, 0x34),
    "RXM-MEASX": (0x02, 0x14),
    "RXM-PMP": (0x02, 0x72),
    "RXM-PMREQ": (0x02, 0x41),
    "RXM-QZSSL6": (0x02, 0x73),
    "RXM-RAWX": (0x02, 0x15),
    "RXM-RLM": (0x02, 0x59),
    "RXM-RTCM": (0x02, 0x32),
    "RXM-SFRBX": (0x02, 0x13),
    "RXM-SPARTN": (0x02, 0x33),
    "RXM-SPARTNKEY": (0x02, 0x36),
    # RX2M: not reviewed
    "RXM-ALM": (0x02, 0x30),
    "RXM-EPH": (0x02, 0x31),
    "RXM-POSREQ": (0x02, 0x40),
    "RXM-RAW": (0x02, 0x10),
    "RXM-SFRB": (0x02, 0x11),
    "RXM-SVSI": (0x02, 0x20),
    # TIM
    "TIM-TM2": (0x0D, 0x03),
    "TIM-TP": (0x0D, 0x01),
    "TIM-VRFY": (0x0D, 0x06),
    # TIM: not reviewed
    "TIM-SVIN": (0x0D, 0x04),
    "TIM-TM": (0x0D, 0x02),
    "UPD-DOWNL": (0x09, 0x01),
    "UPD-EXEC": (0x09, 0x03),
    "UPD-MEMCPY": (0x09, 0x04),
    "UPD-UPLOAD": (0x09, 0x02),
}


CLIDPAIR_INV = dict([[v, k] for k, v in CLIDPAIR.items()])

MSGATTR = {
    "NAV-PVT": [
        "iTOW",
        "year",
        "month",
        "day",
        "hour",
        "min",
        "second",
        "validDate",
        "validMag",
        "validTime",
        "fullyResolved",
        "tAcc",
        "nano",
        "fixType",
        "gnssFixOk",
        "diffSoln",
        "psmState",
        "headVehValid",
        "carrSoln",
        "numSV",
        "lon",
        "lat",
        "height",
        "hMSL",
        "hAcc",
        "vAcc",
        "velN",
        "velE",
        "velD",
        "gSpeed",
        "headMot",
        "sAcc",
        "headAcc",
        "pDOP",
        "headVeh",
        "magDec",
        "magAcc",
    ],
    "NAV-DOP": ["iTOW", "gDOP", "pDOP", "tDOP", "vDOP", "hDOP", "nDOP", "eDOP"],
    "MON-RF": [
        "version",
        "nBlocks",
        "reserved0",
        {
            "rgroup": (
                "nBlocks",
                [
                    "blockId",
                    "jammingState",
                    "antStatus",
                    "antPower",
                    "postStatus",
                    "reserved1",
                    "noisePerMS",
                    "agcCnt",
                    "jamInd",
                    "ofsI",
                    "magI",
                    "ofsQ",
                    "magQ",
                    "reserved2",
                ],
            )
        },
    ],
    "MON-SYS": [
        "msgVer",
        "bootType",
        "cpuLoad",
        "cpuLoadMax",
        "memUsage",
        "memUsageMax",
        "ioUsage",
        "ioUsageMax",
        "runTime",
        "noticeCount",
        "warnCount",
        "errorCount",
        "tempValue",
        "reserved0",
    ],
}


MSGFMT = {
    "NAV-PVT": [
        "<LHBBBBBBLlBBBBllllLLlllllLLHHHHlhH",
        [
            "iTOW",
            "year",
            "month",
            "day",
            "hour",
            "min",
            "sec",
            "valid",
            "tAcc",
            "nano",
            "fixType",
            "flag",
            "flag2",
            "numSV",
            "lon",
            "lat",
            "height",
            "hMSL",
            "hAcc",
            "vAcc",
            "velN",
            "velE",
            "velD",
            "gSpeed",
            "headMot",
            "sAcc",
            "headAcc",
            "pDOP",
            "flag3",
            "reserved0",
            "headVeh",
            "magDec",
            "magAcc",
        ],
    ],
    "NAV-DOP": [
        "<IHHHHHHH",
        ["iTOW", "gDOP", "pDOP", "tDOP", "vDOP", "hDOP", "nDOP", "eDOP"],
    ],
    "MON-RF": ["<BBBB", ["version", "nBlocks", "reserved0", "reserved"]],
}


UBX_TO_PY_DTYPE = {
    # 8-bit (1 byte)
    "U1": "B",
    "I1": "b",
    "X1": "B",
    # 16-bit (2 bytes)
    "U2": "H",
    "I2": "",
    "X2": "",
    # 32-bit (4 bytes)
    "U4": "I",
    "I4": "i",
    "X4": "",
    # 32-bit (4 bytes)
    "R4": "",
    # 64-bit (8 bytes)
    "R8": "",
    "CH": None,
}


class UbxParserState(Enum):
    """ublox Protocol Parser State"""

    IDLE = 1
    SYNC = 2
    READING = 3
